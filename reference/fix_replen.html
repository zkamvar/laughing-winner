<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Find and fix inconsistent repeat lengths — fix_replen • poppr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Find and fix inconsistent repeat lengths — fix_replen"><meta property="og:description" content="Attempts to fix inconsistent repeat lengths found by test_replen"><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">poppr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.9.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/poppr-package.html#functions-in-poppr">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/mlg.html">Analysis of Multilocus Genotypes and Lineages in poppr `r packageVersion('poppr')`</a>
    </li>
    <li>
      <a href="../articles/poppr_manual.html">Data import and manipulation in poppr version `r packageVersion('poppr')`</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/grunwaldlab/poppr" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Find and fix inconsistent repeat lengths</h1>
    <small class="dont-index">Source: <a href="https://github.com/grunwaldlab/poppr/blob/HEAD/R/bruvo.r" class="external-link"><code>R/bruvo.r</code></a></small>
    <div class="hidden name"><code>fix_replen.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Attempts to fix inconsistent repeat lengths found by <code>test_replen</code></p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fix_replen</span><span class="op">(</span><span class="va">gid</span>, <span class="va">replen</span>, e <span class="op">=</span> <span class="fl">1e-05</span>, fix_some <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>gid</dt>
<dd><p>a <code><a href="https://rdrr.io/pkg/adegenet/man/new.genind.html" class="external-link">genind</a></code> or <code><a href="genclone-class.html">genclone</a></code> object</p></dd>


<dt>replen</dt>
<dd><p>a numeric vector of repeat motif lengths.</p></dd>


<dt>e</dt>
<dd><p>a number to be subtracted or added to inconsistent repeat lengths to
allow for proper rounding.</p></dd>


<dt>fix_some</dt>
<dd><p>if <code>TRUE</code> (default), when there are inconsistent repeat 
lengths that cannot be fixed by subtracting or adding e, those than can be 
fixed will. If <code>FALSE</code>, the original repeat lengths will not be fixed.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>a numeric vector of corrected repeat motif lengths.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function is modified from the version used in 
  <a href="https://doi.org/10.5281/zenodo.13007" class="external-link">doi:10.5281/zenodo.13007</a>
.<br> Before being fed into the
  algorithm to calculate Bruvo's distance, the amplicon length is divided by
  the repeat unit length. Because of the amplified primer sequence attached
  to sequence repeat, this division does not always result in an integer and
  so the resulting numbers are rounded. The rounding also protects against
  slight mis-calls of alleles. Because we know that $$\frac{(A - e) - (B
  - e)}{r}$$ is equivalent to $$\frac{A - B}{r}$$, we know that the primer sequence will not alter the relationships
  between the alleles. Unfortunately for nucleotide repeats that have powers
  of 2, rounding in R is based off of the IEC 60559 standard (see
  <code><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></code>), that means that any number ending in 5 is rounded to
  the nearest <em>even</em> digit. This function will attempt to alleviate this
  problem by adding a very small amount to the repeat length so that division
  will not result in a 0.5. If this fails, the same amount will be
  subtracted. If neither of these work, a warning will be issued and it is up
  to the user to determine if the fault is in the allele calls or the repeat
  lengths.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Zhian N. Kamvar, Meg M. Larsen, Alan M. Kanaskie, Everett M. 
  Hansen, &amp; Niklaus J. Grünwald. Sudden_Oak_Death_in_Oregon_Forests: Spatial
  and temporal population dynamics of the sudden oak death epidemic in Oregon
  Forests. ZENODO, <a href="https://doi.org/10.5281/zenodo.13007" class="external-link">doi:10.5281/zenodo.13007</a>
, 2014.</p>  
<p>Kamvar, Z. N., Larsen, M. M., Kanaskie, A. M., Hansen, E. M., &amp; Grünwald,
  N. J. (2015). Spatial and temporal analysis of populations of the sudden
  oak death pathogen in Oregon forests. Phytopathology 105:982-989.
  doi: <a href="https://doi.org/10.1094/PHYTO-12-14-0350-FI" class="external-link">doi:10.1094/PHYTO-12-14-0350-FI</a></p>  
<p>Ruzica Bruvo, Nicolaas K. Michiels, Thomas G. D'Souza, and Hinrich 
  Schulenburg. A simple method for the calculation of microsatellite genotype
  distances irrespective of ploidy level. Molecular Ecology, 13(7):2101-2106,
  2004.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="test_replen.html">test_replen</a></code> <code><a href="bruvo.dist.html">bruvo.dist</a></code>
  <code><a href="bruvo.msn.html">bruvo.msn</a></code> <code><a href="bruvo.boot.html">bruvo.boot</a></code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Zhian N. Kamvar</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Pram</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">Pram_replen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/adegenet/man/accessors.html" class="external-link">locNames</a></span><span class="op">(</span><span class="va">Pram</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  PrMS6A1  Pr9C3A1 PrMS39A1 PrMS45A1 PrMS43A1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        3        2        4        4        4 </span>
<span class="r-in"><span><span class="fu">fix_replen</span><span class="op">(</span><span class="va">Pram</span>, <span class="va">Pram_replen</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  PrMS6A1  Pr9C3A1 PrMS39A1 PrMS45A1 PrMS43A1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3.00000  2.00000  3.99999  4.00000  4.00000 </span>
<span class="r-in"><span><span class="co"># Let's start with an example of a tetranucleotide repeat motif and imagine</span></span></span>
<span class="r-in"><span><span class="co"># that there are twenty alleles all 1 step apart:</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20L</span> <span class="op">*</span> <span class="fl">4L</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  4  8 12 16 20 24 28 32 36 40 44 48 52 56 60 64 68 72 76 80</span>
<span class="r-in"><span><span class="co"># These are the true lengths of the different alleles. Now, let's add the</span></span></span>
<span class="r-in"><span><span class="co"># primer sequence to them. </span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">PxP</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">21</span> <span class="op">+</span> <span class="fl">21</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  46  50  54  58  62  66  70  74  78  82  86  90  94  98 102 106 110 114 118</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [20] 122</span>
<span class="r-in"><span><span class="co"># Now we make sure that x / 4 is equal to 1:20, which we know each have</span></span></span>
<span class="r-in"><span><span class="co"># 1 difference.</span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">/</span><span class="fl">4</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20</span>
<span class="r-in"><span><span class="co"># Now, we divide the sequence with the primers by 4 and see what happens.</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">PxPc</span> <span class="op">&lt;-</span> <span class="va">PxP</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 11.5 12.5 13.5 14.5 15.5 16.5 17.5 18.5 19.5 20.5 21.5 22.5 23.5 24.5 25.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16] 26.5 27.5 28.5 29.5 30.5</span>
<span class="r-in"><span><span class="op">(</span><span class="va">PxPcr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">PxPc</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 12 12 14 14 16 16 18 18 20 20 22 22 24 24 26 26 28 28 30 30</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">PxPcr</span><span class="op">)</span> <span class="co"># we expect all 1s</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 0 2 0 2 0 2 0 2 0 2 0 2 0 2 0 2 0 2 0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Let's try that again by subtracting a tiny amount from 4</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">PxPc</span> <span class="op">&lt;-</span> <span class="va">PxP</span><span class="op">/</span><span class="op">(</span><span class="fl">4</span> <span class="op">-</span> <span class="fl">1e-5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 11.50003 12.50003 13.50003 14.50004 15.50004 16.50004 17.50004 18.50005</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9] 19.50005 20.50005 21.50005 22.50006 23.50006 24.50006 25.50006 26.50007</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17] 27.50007 28.50007 29.50007 30.50008</span>
<span class="r-in"><span><span class="op">(</span><span class="va">PxPcr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">PxPc</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">PxPcr</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Zhian N. Kamvar, Javier F. Tabima, Jonah C. Brooks, David Folarin.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

      </footer></div>

  


  

  </body></html>

